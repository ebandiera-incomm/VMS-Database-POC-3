CREATE OR REPLACE PROCEDURE VMSCMS.SP_INSERT_TXNLOG(PRM_RRN               VARCHAR2,
									PRM_DELIVERY_CHANNEL  VARCHAR2,
									PRM_TERM_ID           VARCHAR2,
									PRM_DATE_TIME         DATE,
									PRM_TXN_CODE          VARCHAR2,
									PRM_TXN_TYPE          VARCHAR2,
									PRM_TXN_MODE          VARCHAR2,
									PRM_TRAN_DATE         VARCHAR2,
									PRM_TRAN_TIME         VARCHAR2,
									PRM_CARD_NO           VARCHAR2,
									PRM_TOPUP_CARDNO      VARCHAR2,
									PRM_TOPUP_ACCTNO      VARCHAR2,
									PRM_TOPUP_ACCTTYPE    VARCHAR2,
									PRM_BANK_CODE         VARCHAR2,
									PRM_TXN_AMT           NUMBER,
									PRM_RULE_INDICATOR    VARCHAR2,
									PRM_RULEGRP_ID        VARCHAR2,
									PRM_MCC_CODE          VARCHAR2,
									PRM_CURR_CODE         VARCHAR2,
									PRM_ADD_CHARGE        VARCHAR2,
									PRM_PROD_ID           VARCHAR2,
									PRM_CATG_ID           VARCHAR2,
									PRM_TIP_AMT           VARCHAR2,
									PRM_DECLINE_RULEID    VARCHAR2,
									PRM_ATMNAME_LOC       VARCHAR2,
									PRM_AUTH_ID           VARCHAR2,
									PRM_MCCCODE_GROUPID   VARCHAR2,
									PRM_CURRCODE_GROUPID  VARCHAR2,
									PRM_TRANSCODE_GROUPID VARCHAR2,
									PRM_RULES             VARCHAR2,
									PRM_PREAUTH_DATE      DATE,
									PRM_ERR_CODE          IN VARCHAR2,
									PRM_RESP_CODE_IN      IN VARCHAR2,
									PRM_PROD_CODE         IN VARCHAR2,
									PRM_PROD_CATTYPE      IN VARCHAR2,
									PRM_NARRATION         IN VARCHAR2,
									PRM_RESP_CODE_OUT     OUT VARCHAR2,
									PRM_RESP_MSG          OUT VARCHAR2) IS
  --Sn create a entry in txn log
BEGIN
  INSERT INTO TRANSACTIONLOG
    (MSGTYPE,
	RRN,
	DELIVERY_CHANNEL,
	TERMINAL_ID,
	DATE_TIME,
	TXN_CODE,
	TXN_TYPE,
	TXN_MODE,
	TXN_STATUS,
	RESPONSE_CODE,
	BUSINESS_DATE,
	BUSINESS_TIME,
	CUSTOMER_CARD_NO,
	TOPUP_CARD_NO,
	TOPUP_ACCT_NO,
	TOPUP_ACCT_TYPE,
	BANK_CODE,
	TOTAL_AMOUNT,
	RULE_INDICATOR,
	RULEGROUPID,
	MCCODE,
	CURRENCYCODE,
	ADDCHARGE,
	PRODUCTID,
	CATEGORYID,
	TIPS,
	DECLINE_RULEID,
	ATM_NAME_LOCATION,
	AUTH_ID,
	TRANS_DESC,
	AMOUNT,
	PREAUTHAMOUNT,
	PARTIALAMOUNT,
	MCCODEGROUPID,
	CURRENCYCODEGROUPID,
	TRANSCODEGROUPID,
	RULES,
	PREAUTH_DATE,
	GL_UPD_FLAG,
	RESPONSE_ID)
  VALUES
    ('210',
	PRM_RRN,
	PRM_DELIVERY_CHANNEL,
	PRM_TERM_ID,
	PRM_TRAN_TIME,
	PRM_TXN_CODE,
	PRM_TXN_TYPE,
	PRM_TXN_MODE,
	DECODE(PRM_RESP_CODE_IN, '00', 'C', 'F'),
	PRM_RESP_CODE_IN,
	PRM_TRAN_DATE,
	SUBSTR(PRM_TRAN_TIME, 1, 6),
	PRM_CARD_NO,
	PRM_TOPUP_CARDNO,
	PRM_TOPUP_ACCTNO,
	PRM_TOPUP_ACCTTYPE,
	PRM_BANK_CODE,
	PRM_TXN_AMT,
	PRM_RULE_INDICATOR,
	PRM_RULEGRP_ID,
	PRM_MCC_CODE,
	PRM_CURR_CODE,
	PRM_ADD_CHARGE,
	PRM_PROD_CODE,
	PRM_PROD_CATTYPE,
	PRM_TIP_AMT,
	PRM_DECLINE_RULEID,
	PRM_ATMNAME_LOC,
	PRM_AUTH_ID,
	PRM_NARRATION,
	PRM_TXN_AMT,
	NULL, --- PRE AUTH AMOUNT
	NULL, -- Partial amount (will be given for partial txn)
	PRM_MCCCODE_GROUPID,
	PRM_CURRCODE_GROUPID,
	PRM_TRANSCODE_GROUPID,
	PRM_RULES,
	PRM_PREAUTH_DATE,
	'N',
	PRM_RESP_CODE_IN);
EXCEPTION
  WHEN OTHERS THEN
    PRM_RESP_MSG      := 'Problem while inserting data into transaction log  dtl' ||
					SUBSTR(SQLERRM, 1, 300);
    PRM_RESP_CODE_OUT := '999';
END;
--En create a entry in txn log
/


